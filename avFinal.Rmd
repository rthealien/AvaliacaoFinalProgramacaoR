---
title: "Avaliação Final de Introdução à Programação em R"
author: Giovanni Angelo dos Santos, Pedro Leonardo Motta Weyne Marques e Rafael Gomes de Oliveira
date: "07/11/2021"
output: 
  rmdformats::material
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rmarkdown)
```
# Início

## Introdução

Esse documento é o resultado da avaliação final da matéria **Introdução à Programação em R**, ministrada pela professora Nadine, do curso de Especialização em Ciência de Dados na Fundação CEPERJ.

## Requisitos

Para a geração correta do Knit é necessária a instalação do pacote **rmdformats** através do commando

``` {r requisitos, eval=FALSE}
install.packages("rmdformats")
```

## Dados

Serão utilizados os dados sobre as despesas cobertas pela cota para exercício da atividade parlamentar do deputados em 2020

```{r dados,warning=FALSE, echo=FALSE}
dados <- read.csv2("Ano-2020.csv", encoding = "UTF-8")
dadosDeputados = dados %>% filter(!is.na(cpf))
paged_table(dadosDeputados)
```

```{r summary,warning=FALSE, echo=FALSE}
#table(dadosDeputados)
```

## Grupo

O grupo responsável por esse projeto é formado por:

- Giovanni Angelo dos Santos
- Pedro Leonardo Motta Weyne Marques
- Rafael Gomes de Oliveira

# Análise

## Valor Gasto por Estado


```{r gasto_estado,message=FALSE, warning=FALSE, echo=FALSE}
#dadosDeputados %>% 
#  mutate(ï..txNomeParlamentar = txtNomeParlamentar)

gatos_estado = dadosDeputados %>% 
  group_by(sgUF) %>% 
  summarise(valor = sum(as.numeric(vlrLiquido), na.rm = TRUE))

library(geobr)

dadosMapa <- structure(
list(X = 1:27, 
   uf = gatos_estado$sgUF, 
   valor = gatos_estado$valor), class = "data.frame", row.names = c(NA, -27L))
states <- read_country(year = 2020)
states <- dplyr::left_join(states, dadosMapa, by = c("abbrev_state" = "uf"))
L = min(states$valor)
S = max(states$valor)

p = states %>% ggplot() + 
  geom_sf(aes(fill =  valor), size = 0.9) +
  scale_fill_gradient(low = "red", high = "blue", name = "Gasto por Estado (R$)", limits = c(L, S), labels = scales::label_dollar(prefix="R$ ")) + 
  xlab("") +  ylab("") +geom_sf_label(aes(label = abbrev_state),label.padding = unit(0.5, "mm"),size = 3) 


p = p +   labs(title = "Gasto por Estado") +
  theme(plot.caption = element_text(hjust = 0, face= "italic"), 
        plot.title.position = "plot", 
        plot.caption.position =  "plot") 

p = p + theme(legend.position = "bottom") + theme(legend.title = element_text(size = 10),legend.text=element_text(size=10))

plot(p)
```

## Valor Gasto por Deputado

Análise para saber quais deputados tiveram mais gastos durante o ano

```{r gasto_deputado,message=FALSE, warning=FALSE,echo=FALSE}
#Filtro
gastos_deputados = dadosDeputados %>% 
                    group_by(cpf,txNomeParlamentar) %>% 
                    summarise(valor = sum(as.numeric(vlrLiquido), na.rm = TRUE)) %>% 
                    arrange(desc(valor)) %>% 
                    select(txNomeParlamentar,valor)

head(gastos_deputados,10)

#Testes com gráficos
p<-ggplot(gastos_deputados)+
 geom_point(aes(x = txNomeParlamentar, y = valor, color = valor))

require(scales)
p +
  scale_y_continuous(labels = scales::label_dollar(prefix="R$ ")) +
  scale_color_continuous(labels = scales::label_dollar(prefix="R$ "))

```

## Valor Gasto por Partido

gastos_partidos = dadosDeputados %>% 
                    group_by(sgUF) %>% 
                    summarise(valor = sum(as.numeric(vlrLiquido), na.rm = TRUE)) %>% 
                    arrange(desc(valor))

paged_table(gastos_partidos)


## Valor Gasto com Empresas Estrangeiras


## Valor Gasto por Mês 






This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

# Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
